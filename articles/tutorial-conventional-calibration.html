<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tutorial: Conventional Calibration from Raw Data • measure.sec</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial: Conventional Calibration from Raw Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">measure.sec</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-guides">
<li><h6 class="dropdown-header" data-toc-skip>How-to Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/triple-detection.html">Multi-Detector SEC</a></li>
    <li><a class="dropdown-item" href="../articles/mals-detection.html">MALS Detection</a></li>
    <li><a class="dropdown-item" href="../articles/lals-rals-detection.html">LALS/RALS Detection</a></li>
    <li><a class="dropdown-item" href="../articles/protein-sec.html">Protein SEC Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/copolymer-analysis.html">Copolymer Composition</a></li>
    <li><a class="dropdown-item" href="../articles/calibration-management.html">Calibration Management</a></li>
    <li><a class="dropdown-item" href="../articles/system-suitability.html">System Suitability</a></li>
    <li><a class="dropdown-item" href="../articles/branching-analysis.html">Polymer Branching</a></li>
    <li><a class="dropdown-item" href="../articles/exporting-results.html">Exporting Results</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Reference</h6></li>
    <li><a class="dropdown-item" href="../articles/sec-analysis.html">Comprehensive SEC Analysis</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JamesHWade/measure-sec/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Tutorial: Conventional Calibration from Raw Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JamesHWade/measure-sec/blob/main/vignettes/tutorial-conventional-calibration.Rmd" class="external-link"><code>vignettes/tutorial-conventional-calibration.Rmd</code></a></small>
      <div class="d-none name"><code>tutorial-conventional-calibration.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="what-youll-learn">What You’ll Learn<a class="anchor" aria-label="anchor" href="#what-youll-learn"></a>
</h3>
<p>This tutorial walks through a <strong>realistic SEC/GPC analysis
workflow</strong> from raw instrument data to final molecular weight
results. By the end, you will be able to:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Process raw standard chromatograms</strong> with noise and
baseline drift</li>
<li>
<strong>Build and validate</strong> a conventional calibration
curve</li>
<li>
<strong>Save calibrations</strong> for reuse in future sessions</li>
<li>
<strong>Analyze unknown samples</strong> using your saved
calibration</li>
<li>
<strong>Validate results</strong> against known values</li>
</ol>
<p><strong>Time to complete</strong>: ~30 minutes</p>
</div>
<div class="section level3">
<h3 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h3>
<ul>
<li>Basic R knowledge (data frames, pipes)</li>
<li>Completed the <a href="getting-started.html">Getting Started</a>
tutorial</li>
<li>Understanding of what SEC/GPC does (separates polymers by size)</li>
</ul>
</div>
<div class="section level3">
<h3 id="the-lab-scenario">The Lab Scenario<a class="anchor" aria-label="anchor" href="#the-lab-scenario"></a>
</h3>
<p>Imagine you’re in a polymer analysis lab:</p>
<p><strong>Day 1 (Today):</strong></p>
<ul>
<li>Run 12 polystyrene narrow standards on your SEC system</li>
<li>Process the raw data and build a calibration curve</li>
<li>Validate the calibration quality</li>
<li>Save the calibration for future use</li>
</ul>
<p><strong>Day 2 (Tomorrow):</strong></p>
<ul>
<li>Run unknown polymer samples</li>
<li>Apply yesterday’s calibration</li>
<li>Calculate molecular weight averages</li>
<li>Compare to expected values</li>
</ul>
<p>Let’s get started!</p>
</div>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jameshwade.github.io/measure/" class="external-link">measure</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: recipes</span></span>
<span><span class="co">#&gt; Loading required package: dplyr</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'recipes'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     step</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JamesHWade/measure-sec" class="external-link">measure.sec</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/recipes" class="external-link">recipes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="day-1-building-the-calibration">Day 1: Building the Calibration<a class="anchor" aria-label="anchor" href="#day-1-building-the-calibration"></a>
</h2>
<div class="section level3">
<h3 id="load-raw-standard-data">Load Raw Standard Data<a class="anchor" aria-label="anchor" href="#load-raw-standard-data"></a>
</h3>
<p>The package includes <code>sec_raw_standards</code>, which contains
realistic raw chromatogram data for 12 polystyrene narrow standards.
This data mimics what you’d export from an SEC instrument—complete with
noise, baseline drift, and injection artifacts.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sec_raw_standards</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the structure - this is raw detector output</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">sec_raw_standards</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 129,612</span></span>
<span><span class="co">#&gt; Columns: 6</span></span>
<span><span class="co">#&gt; $ standard_name <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PS-580"<span style="color: #949494;">, </span>"PS-580"<span style="color: #949494;">, </span>"PS-580"<span style="color: #949494;">, </span>"PS-580"<span style="color: #949494;">, </span>"PS-580"<span style="color: #949494;">, </span>"PS-58…</span></span>
<span><span class="co">#&gt; $ mp            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 580<span style="color: #949494;">, </span>580<span style="color: #949494;">, </span>580<span style="color: #949494;">, </span>580<span style="color: #949494;">, </span>580<span style="color: #949494;">, </span>580<span style="color: #949494;">, </span>580<span style="color: #949494;">, </span>580<span style="color: #949494;">, </span>580<span style="color: #949494;">, </span>580<span style="color: #949494;">, </span>580<span style="color: #949494;">, </span>5…</span></span>
<span><span class="co">#&gt; $ log_mp        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.763428<span style="color: #949494;">, </span>2.763428<span style="color: #949494;">, </span>2.763428<span style="color: #949494;">, </span>2.763428<span style="color: #949494;">, </span>2.763428<span style="color: #949494;">, </span>2.7634…</span></span>
<span><span class="co">#&gt; $ dispersity    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.06<span style="color: #949494;">, </span>1.06<span style="color: #949494;">, </span>1.06<span style="color: #949494;">, </span>1.06<span style="color: #949494;">, </span>1.06<span style="color: #949494;">, </span>1.06<span style="color: #949494;">, </span>1.06<span style="color: #949494;">, </span>1.06<span style="color: #949494;">, </span>1.06<span style="color: #949494;">, </span>1.…</span></span>
<span><span class="co">#&gt; $ time_min      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 4.0000<span style="color: #949494;">, </span>4.0017<span style="color: #949494;">, </span>4.0033<span style="color: #949494;">, </span>4.0050<span style="color: #949494;">, </span>4.0067<span style="color: #949494;">, </span>4.0083<span style="color: #949494;">, </span>4.0100<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ ri_mv         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 3.701<span style="color: #949494;">, </span>4.695<span style="color: #949494;">, </span>4.264<span style="color: #949494;">, </span>3.720<span style="color: #949494;">, </span>2.092<span style="color: #949494;">, </span>3.448<span style="color: #949494;">, </span>3.003<span style="color: #949494;">, </span>3.847<span style="color: #949494;">, </span>…</span></span>
<span></span>
<span><span class="co"># View the available standards</span></span>
<span><span class="va">sec_raw_standards</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">standard_name</span>, <span class="va">mp</span>, <span class="va">log_mp</span>, <span class="va">dispersity</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">mp</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 4</span></span></span>
<span><span class="co">#&gt;    standard_name     mp log_mp dispersity</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> PS-930000     <span style="text-decoration: underline;">930</span>000   5.97       1.02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> PS-495000     <span style="text-decoration: underline;">495</span>000   5.69       1.02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> PS-270000     <span style="text-decoration: underline;">270</span>000   5.43       1.01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> PS-135000     <span style="text-decoration: underline;">135</span>000   5.13       1.01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> PS-67500       <span style="text-decoration: underline;">67</span>500   4.83       1.02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> PS-33500       <span style="text-decoration: underline;">33</span>500   4.53       1.02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> PS-19600       <span style="text-decoration: underline;">19</span>600   4.29       1.02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> PS-9680         <span style="text-decoration: underline;">9</span>680   3.99       1.02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> PS-5970         <span style="text-decoration: underline;">5</span>970   3.78       1.02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> PS-2960         <span style="text-decoration: underline;">2</span>960   3.47       1.03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> PS-1270         <span style="text-decoration: underline;">1</span>270   3.10       1.04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> PS-580           580   2.76       1.06</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot all raw chromatograms overlaid</span></span>
<span><span class="co"># Note the noise and baseline variation - this is realistic data!</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sec_raw_standards</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time_min</span>, <span class="va">ri_mv</span>, color <span class="op">=</span> <span class="va">standard_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"turbo"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Time (min)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"RI Signal (mV)"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Raw Polystyrene Standards"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"12 narrow standards from 580 Da to 930K Da"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Standard"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial-conventional-calibration_files/figure-html/plot-raw-standards-1.png" class="r-plt" alt="" width="672"></p>
<p>Notice that:</p>
<ul>
<li>Higher MW standards elute earlier (larger molecules excluded from
pores)</li>
<li>Lower MW standards elute later (smaller molecules enter pores)</li>
<li>There’s visible noise and baseline variation—this is normal for raw
data</li>
</ul>
</div>
<div class="section level3">
<h3 id="process-the-standards">Process the Standards<a class="anchor" aria-label="anchor" href="#process-the-standards"></a>
</h3>
<p>Before building a calibration curve, we need to:</p>
<ol style="list-style-type: decimal">
<li>Baseline correct each chromatogram</li>
<li>Find the peak retention time for each standard</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Process each standard separately and find peak retention times</span></span>
<span><span class="va">process_standard</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">std_data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">std_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">std_data</span><span class="op">$</span><span class="va">standard_name</span><span class="op">)</span></span>
<span>  <span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">std_data</span><span class="op">$</span><span class="va">mp</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Create recipe for baseline correction</span></span>
<span>  <span class="va">rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">ri_mv</span> <span class="op">+</span> <span class="va">time_min</span> <span class="op">~</span> <span class="va">standard_name</span>, data <span class="op">=</span> <span class="va">std_data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://recipes.tidymodels.org/reference/roles.html" class="external-link">update_role</a></span><span class="op">(</span><span class="va">standard_name</span>, new_role <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://jameshwade.github.io/measure/reference/step_measure_input_long.html" class="external-link">step_measure_input_long</a></span><span class="op">(</span></span>
<span>      <span class="va">ri_mv</span>,</span>
<span>      location <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">time_min</span><span class="op">)</span>,</span>
<span>      col_name <span class="op">=</span> <span class="st">"ri"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/step_sec_baseline.html">step_sec_baseline</a></span><span class="op">(</span>measures <span class="op">=</span> <span class="st">"ri"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Process</span></span>
<span>  <span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span><span class="va">rec</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Extract chromatogram data</span></span>
<span>  <span class="va">chrom</span> <span class="op">&lt;-</span> <span class="va">processed</span><span class="op">$</span><span class="va">ri</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># Find peak (maximum signal after baseline correction)</span></span>
<span>  <span class="va">peak_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">chrom</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span>
<span>  <span class="va">peak_time</span> <span class="op">&lt;-</span> <span class="va">chrom</span><span class="op">$</span><span class="va">location</span><span class="op">[</span><span class="va">peak_idx</span><span class="op">]</span></span>
<span>  <span class="va">peak_height</span> <span class="op">&lt;-</span> <span class="va">chrom</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">peak_idx</span><span class="op">]</span></span>
<span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    standard_name <span class="op">=</span> <span class="va">std_name</span>,</span>
<span>    mp <span class="op">=</span> <span class="va">mp</span>,</span>
<span>    log_mp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">mp</span><span class="op">)</span>,</span>
<span>    retention_time <span class="op">=</span> <span class="va">peak_time</span>,</span>
<span>    peak_height <span class="op">=</span> <span class="va">peak_height</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Process all standards</span></span>
<span><span class="va">peak_data</span> <span class="op">&lt;-</span> <span class="va">sec_raw_standards</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">standard_name</span>, <span class="va">mp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html" class="external-link">group_split</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">process_standard</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">mp</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">peak_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 5</span></span></span>
<span><span class="co">#&gt;    standard_name     mp log_mp retention_time peak_height</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> PS-930000     <span style="text-decoration: underline;">930</span>000   5.97           14.7       154. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> PS-495000     <span style="text-decoration: underline;">495</span>000   5.69           14.9       140. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> PS-270000     <span style="text-decoration: underline;">270</span>000   5.43           14.6       139. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> PS-135000     <span style="text-decoration: underline;">135</span>000   5.13           15.2       129. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> PS-67500       <span style="text-decoration: underline;">67</span>500   4.83           15.2       116. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> PS-33500       <span style="text-decoration: underline;">33</span>500   4.53           15.3       114. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> PS-19600       <span style="text-decoration: underline;">19</span>600   4.29           15.5       108. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> PS-9680         <span style="text-decoration: underline;">9</span>680   3.99           16.0       116. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> PS-5970         <span style="text-decoration: underline;">5</span>970   3.78           15.4       116. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> PS-2960         <span style="text-decoration: underline;">2</span>960   3.47           15.7        99.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> PS-1270         <span style="text-decoration: underline;">1</span>270   3.10           16.2        85.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> PS-580           580   2.76           15.7        97.5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="build-the-calibration-curve">Build the Calibration Curve<a class="anchor" aria-label="anchor" href="#build-the-calibration-curve"></a>
</h3>
<p>Now we fit a polynomial relationship between retention time and
log(MW):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare calibration data in the required format</span></span>
<span><span class="va">cal_data</span> <span class="op">&lt;-</span> <span class="va">peak_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>retention <span class="op">=</span> <span class="va">retention_time</span>, log_mw <span class="op">=</span> <span class="va">log_mp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit a cubic polynomial (most common for SEC)</span></span>
<span><span class="va">cal_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">log_mw</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">retention</span>, <span class="fl">3</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">cal_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View fit summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cal_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = log_mw ~ poly(retention, 3, raw = TRUE), data = cal_data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">#&gt; -0.76711 -0.30311  0.05885  0.24252  0.79052 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                                  Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span><span class="co">#&gt; (Intercept)                     -9825.163   6164.019  -1.594    0.150</span></span>
<span><span class="co">#&gt; poly(retention, 3, raw = TRUE)1  1928.243   1201.114   1.605    0.147</span></span>
<span><span class="co">#&gt; poly(retention, 3, raw = TRUE)2  -125.880     77.969  -1.615    0.145</span></span>
<span><span class="co">#&gt; poly(retention, 3, raw = TRUE)3     2.735      1.686   1.622    0.143</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 0.4956 on 8 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.8324, Adjusted R-squared:  0.7696 </span></span>
<span><span class="co">#&gt; F-statistic: 13.25 on 3 and 8 DF,  p-value: 0.001805</span></span>
<span></span>
<span><span class="co"># Calculate R-squared</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nCalibration R² ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cal_fit</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span>, <span class="fl">5</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calibration R² = 0.83243</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize calibration with confidence intervals</span></span>
<span><span class="va">cal_pred</span> <span class="op">&lt;-</span> <span class="va">cal_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    fitted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">cal_fit</span><span class="op">)</span>,</span>
<span>    residual <span class="op">=</span> <span class="va">log_mw</span> <span class="op">-</span> <span class="va">fitted</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Add prediction interval for new observations</span></span>
<span><span class="va">pred_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">cal_fit</span>, newdata <span class="op">=</span> <span class="va">cal_data</span>, interval <span class="op">=</span> <span class="st">"prediction"</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="va">cal_pred</span> <span class="op">&lt;-</span> <span class="va">cal_pred</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    lwr <span class="op">=</span> <span class="va">pred_int</span><span class="op">[</span>, <span class="st">"lwr"</span><span class="op">]</span>,</span>
<span>    upr <span class="op">=</span> <span class="va">pred_int</span><span class="op">[</span>, <span class="st">"upr"</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cal_pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">retention</span>, <span class="va">log_mw</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lwr</span>, ymax <span class="op">=</span> <span class="va">upr</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"#A23B72"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">3</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    se <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="st">"#A23B72"</span>, fill <span class="op">=</span> <span class="st">"#A23B72"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"#2E86AB"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Retention Time (min)"</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">log</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">(</span><span class="va">M</span><span class="op">[</span><span class="va">p</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Polystyrene Calibration Curve"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Cubic fit, R² ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cal_fit</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial-conventional-calibration_files/figure-html/plot-calibration-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="validate-calibration-quality">Validate Calibration Quality<a class="anchor" aria-label="anchor" href="#validate-calibration-quality"></a>
</h3>
<p>A good calibration should have:</p>
<ul>
<li>R² &gt; 0.999 (ideally &gt; 0.9999)</li>
<li>Random residual pattern (no systematic bias)</li>
<li>Small relative deviations (&lt; 5% for most standards)</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate % deviation for each standard</span></span>
<span><span class="va">cal_pred</span> <span class="op">&lt;-</span> <span class="va">cal_pred</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">peak_data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>retention <span class="op">=</span> <span class="va">retention_time</span>, <span class="va">standard_name</span>, <span class="va">mp</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"retention"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    predicted_mp <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="va">fitted</span>,</span>
<span>    pct_deviation <span class="op">=</span> <span class="op">(</span><span class="va">predicted_mp</span> <span class="op">-</span> <span class="va">mp</span><span class="op">)</span> <span class="op">/</span> <span class="va">mp</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Residual plot</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cal_pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">retention</span>, <span class="va">residual</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"#2E86AB"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">retention</span>, yend <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Retention Time (min)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Residual (log₁₀ MW)"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Calibration Residuals"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Percent deviation bar chart</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cal_pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">standard_name</span>, <span class="va">mp</span><span class="op">)</span>, <span class="va">pct_deviation</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">cal_pred</span><span class="op">$</span><span class="va">pct_deviation</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">5</span>, <span class="st">"#E74C3C"</span>, <span class="st">"#2E86AB"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">""</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"% Deviation from Certificate"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Standard Deviation Analysis"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Red bars exceed ±5% threshold"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display plots</span></span>
<span><span class="va">p1</span></span></code></pre></div>
<p><img src="tutorial-conventional-calibration_files/figure-html/validate-calibration-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p2</span></span></code></pre></div>
<p><img src="tutorial-conventional-calibration_files/figure-html/validate-calibration-2.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calibration quality summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"=== Calibration Quality Summary ===\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; === Calibration Quality Summary ===</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"R-squared:        "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cal_fit</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span>, <span class="fl">6</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; R-squared:         0.832433</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Residual Std Err: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cal_fit</span><span class="op">)</span><span class="op">$</span><span class="va">sigma</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"log₁₀ MW\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Residual Std Err:  0.4956 log₁₀ MW</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Max |% Deviation|:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">cal_pred</span><span class="op">$</span><span class="va">pct_deviation</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Max |% Deviation|: 484.94 %</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean |% Deviation|:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">cal_pred</span><span class="op">$</span><span class="va">pct_deviation</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mean |% Deviation|: 99.12 %</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nCalibration Range:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calibration Range:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  MW:        "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">peak_data</span><span class="op">$</span><span class="va">mp</span><span class="op">)</span>, big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span>, <span class="st">"to"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">peak_data</span><span class="op">$</span><span class="va">mp</span><span class="op">)</span>, big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span>, <span class="st">"Da\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   MW:         580 to 930,000 Da</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Retention: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">cal_data</span><span class="op">$</span><span class="va">retention</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"to"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">cal_data</span><span class="op">$</span><span class="va">retention</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"min\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Retention:  14.64 to 16.21 min</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="save-the-calibration">Save the Calibration<a class="anchor" aria-label="anchor" href="#save-the-calibration"></a>
</h3>
<p>Save your calibration so you can reuse it tomorrow (and beyond):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save calibration to a file</span></span>
<span><span class="fu"><a href="../reference/save_sec_calibration.html">save_sec_calibration</a></span><span class="op">(</span></span>
<span>  calibration <span class="op">=</span> <span class="va">cal_data</span>,</span>
<span>  fit_type <span class="op">=</span> <span class="st">"cubic"</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"ps_calibration_2026-01-04.rds"</span>,</span>
<span>  metadata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    column <span class="op">=</span> <span class="st">"PLgel Mixed-C"</span>,</span>
<span>    solvent <span class="op">=</span> <span class="st">"THF"</span>,</span>
<span>    flow_rate <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>    temperature <span class="op">=</span> <span class="fl">35</span>,</span>
<span>    standards <span class="op">=</span> <span class="st">"PS EasiVial kit"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Calibration saved successfully!\n"</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p><strong>Tip</strong>: Include the date in your calibration filename.
Calibrations can drift over time as columns age, so it’s good practice
to rebuild periodically.</p>
</blockquote>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="day-2-analyzing-unknown-samples">Day 2: Analyzing Unknown Samples<a class="anchor" aria-label="anchor" href="#day-2-analyzing-unknown-samples"></a>
</h2>
<div class="section level3">
<h3 id="load-saved-calibration">Load Saved Calibration<a class="anchor" aria-label="anchor" href="#load-saved-calibration"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load yesterday's calibration</span></span>
<span><span class="va">cal_saved</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_sec_calibration.html">load_sec_calibration</a></span><span class="op">(</span><span class="st">"ps_calibration_2026-01-04.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the metadata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Calibration from:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">cal_saved</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Column:"</span>, <span class="va">cal_saved</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">column</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Fit type:"</span>, <span class="va">cal_saved</span><span class="op">$</span><span class="va">fit_type</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<p>For this tutorial, we’ll use the calibration we just built:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use the calibration data we prepared</span></span>
<span><span class="co"># (In practice, you'd load from file)</span></span>
<span><span class="va">ps_cal</span> <span class="op">&lt;-</span> <span class="va">cal_data</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-unknown-samples">Load Unknown Samples<a class="anchor" aria-label="anchor" href="#load-unknown-samples"></a>
</h3>
<p>The package includes <code>sec_raw_unknowns</code> with realistic
unknown samples that have known “true” MW values for validation:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sec_raw_unknowns</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the samples</span></span>
<span><span class="va">sec_raw_unknowns</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="va">description</span>, <span class="va">true_mw</span>, <span class="va">true_mn</span>, <span class="va">true_dispersity</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt;   sample_id       description                   true_mw true_mn true_dispersity</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Unknown-A       Broad distribution PMMA-like    <span style="text-decoration: underline;">45</span>000   <span style="text-decoration: underline;">22</span>000            2.05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Unknown-B       Medium dispersity PS-like      <span style="text-decoration: underline;">125</span>000   <span style="text-decoration: underline;">95</span>000            1.32</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Unknown-C       Narrow distribution reference   <span style="text-decoration: underline;">82</span>000   <span style="text-decoration: underline;">75</span>000            1.09</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Unknown-Bimodal Bimodal mixture (50K + 200K)       <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Unknown-HMW     Very high MW with aggregates  1<span style="text-decoration: underline;">500</span>000 1<span style="text-decoration: underline;">200</span>000            1.25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Unknown-LMW     Low MW oligomer region           <span style="text-decoration: underline;">3</span>500    <span style="text-decoration: underline;">2</span>800            1.25</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot raw unknown chromatograms</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sec_raw_unknowns</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time_min</span>, <span class="va">ri_mv</span>, color <span class="op">=</span> <span class="va">sample_id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">sample_id</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Time (min)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"RI Signal (mV)"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Raw Unknown Sample Chromatograms"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial-conventional-calibration_files/figure-html/plot-unknowns-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="analyze-unknowns-with-calibration">Analyze Unknowns with Calibration<a class="anchor" aria-label="anchor" href="#analyze-unknowns-with-calibration"></a>
</h3>
<p>Now we apply our calibration to calculate molecular weights:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Process all unknowns at once</span></span>
<span><span class="co"># First, let's work with one sample to show the workflow</span></span>
<span><span class="va">unknown_a</span> <span class="op">&lt;-</span> <span class="va">sec_raw_unknowns</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sample_id</span> <span class="op">==</span> <span class="st">"Unknown-A"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build the analysis recipe</span></span>
<span><span class="va">rec_unknown</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">ri_mv</span> <span class="op">+</span> <span class="va">time_min</span> <span class="op">~</span> <span class="va">sample_id</span>, data <span class="op">=</span> <span class="va">unknown_a</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/roles.html" class="external-link">update_role</a></span><span class="op">(</span><span class="va">sample_id</span>, new_role <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://jameshwade.github.io/measure/reference/step_measure_input_long.html" class="external-link">step_measure_input_long</a></span><span class="op">(</span></span>
<span>    <span class="va">ri_mv</span>,</span>
<span>    location <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">time_min</span><span class="op">)</span>,</span>
<span>    col_name <span class="op">=</span> <span class="st">"ri"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/step_sec_baseline.html">step_sec_baseline</a></span><span class="op">(</span>measures <span class="op">=</span> <span class="st">"ri"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/step_sec_conventional_cal.html">step_sec_conventional_cal</a></span><span class="op">(</span></span>
<span>    standards <span class="op">=</span> <span class="va">ps_cal</span>,</span>
<span>    fit_type <span class="op">=</span> <span class="st">"cubic"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/step_sec_mw_averages.html">step_sec_mw_averages</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Process</span></span>
<span><span class="va">result_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span><span class="va">rec_unknown</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Calibration fit quality is low (R\u00b2 = 0.8324).</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Typical calibrations have R\u00b2 &gt; 0.999.</span></span>
<span><span class="co">#&gt; Warning: Standard at 15.67 has 484.9% MW deviation.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Consider removing outlier standards or using a different fit type.</span></span>
<span><span class="co">#&gt; Warning: 9857 points (91.3%) are outside calibration range.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Calibration range: 14.64 to 16.21</span></span>
<span></span>
<span><span class="co"># View results</span></span>
<span><span class="va">result_a</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="va">mw_mn</span>, <span class="va">mw_mw</span>, <span class="va">mw_mz</span>, <span class="va">mw_dispersity</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">#&gt;   sample_id    mw_mn   mw_mw   mw_mz mw_dispersity</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Unknown-A 8<span style="text-decoration: underline;">901</span>726. 1.77<span style="color: #949494;">e</span>19 1.06<span style="color: #949494;">e</span>21       1.99<span style="color: #949494;">e</span>12</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="process-all-unknowns">Process All Unknowns<a class="anchor" aria-label="anchor" href="#process-all-unknowns"></a>
</h3>
<p>Let’s analyze all unknown samples and compare to their true
values:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">analyze_unknown</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sample_data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">sample_data</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">ri_mv</span> <span class="op">+</span> <span class="va">time_min</span> <span class="op">~</span> <span class="va">sample_id</span>, data <span class="op">=</span> <span class="va">sample_data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://recipes.tidymodels.org/reference/roles.html" class="external-link">update_role</a></span><span class="op">(</span><span class="va">sample_id</span>, new_role <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://jameshwade.github.io/measure/reference/step_measure_input_long.html" class="external-link">step_measure_input_long</a></span><span class="op">(</span></span>
<span>      <span class="va">ri_mv</span>,</span>
<span>      location <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">time_min</span><span class="op">)</span>,</span>
<span>      col_name <span class="op">=</span> <span class="st">"ri"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/step_sec_baseline.html">step_sec_baseline</a></span><span class="op">(</span>measures <span class="op">=</span> <span class="st">"ri"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/step_sec_conventional_cal.html">step_sec_conventional_cal</a></span><span class="op">(</span></span>
<span>      standards <span class="op">=</span> <span class="va">ps_cal</span>,</span>
<span>      fit_type <span class="op">=</span> <span class="st">"cubic"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/step_sec_mw_averages.html">step_sec_mw_averages</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span><span class="va">rec</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">result</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="va">mw_mn</span>, <span class="va">mw_mw</span>, <span class="va">mw_mz</span>, <span class="va">mw_dispersity</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Analyze all unknowns (excluding bimodal for now - needs special handling)</span></span>
<span><span class="va">all_results</span> <span class="op">&lt;-</span> <span class="va">sec_raw_unknowns</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sample_id</span> <span class="op">!=</span> <span class="st">"Unknown-Bimodal"</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Skip bimodal for standard analysis</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html" class="external-link">group_split</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">analyze_unknown</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Calibration fit quality is low (R\u00b2 = 0.8324).</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Typical calibrations have R\u00b2 &gt; 0.999.</span></span>
<span><span class="co">#&gt; Warning: Standard at 15.67 has 484.9% MW deviation.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Consider removing outlier standards or using a different fit type.</span></span>
<span><span class="co">#&gt; Warning: 9857 points (91.3%) are outside calibration range.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Calibration range: 14.64 to 16.21</span></span>
<span><span class="co">#&gt; Warning: Calibration fit quality is low (R\u00b2 = 0.8324).</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Typical calibrations have R\u00b2 &gt; 0.999.</span></span>
<span><span class="co">#&gt; Warning: Standard at 15.67 has 484.9% MW deviation.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Consider removing outlier standards or using a different fit type.</span></span>
<span><span class="co">#&gt; Warning: 9857 points (91.3%) are outside calibration range.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Calibration range: 14.64 to 16.21</span></span>
<span><span class="co">#&gt; Warning: Calibration fit quality is low (R\u00b2 = 0.8324).</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Typical calibrations have R\u00b2 &gt; 0.999.</span></span>
<span><span class="co">#&gt; Warning: Standard at 15.67 has 484.9% MW deviation.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Consider removing outlier standards or using a different fit type.</span></span>
<span><span class="co">#&gt; Warning: 9857 points (91.3%) are outside calibration range.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Calibration range: 14.64 to 16.21</span></span>
<span><span class="co">#&gt; Warning: Calibration fit quality is low (R\u00b2 = 0.8324).</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Typical calibrations have R\u00b2 &gt; 0.999.</span></span>
<span><span class="co">#&gt; Warning: Standard at 15.67 has 484.9% MW deviation.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Consider removing outlier standards or using a different fit type.</span></span>
<span><span class="co">#&gt; Warning: 9857 points (91.3%) are outside calibration range.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Calibration range: 14.64 to 16.21</span></span>
<span><span class="co">#&gt; Warning: Calibration fit quality is low (R\u00b2 = 0.8324).</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Typical calibrations have R\u00b2 &gt; 0.999.</span></span>
<span><span class="co">#&gt; Warning: Standard at 15.67 has 484.9% MW deviation.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Consider removing outlier standards or using a different fit type.</span></span>
<span><span class="co">#&gt; Warning: 9857 points (91.3%) are outside calibration range.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Calibration range: 14.64 to 16.21</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">all_results</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 5</span></span></span>
<span><span class="co">#&gt;   sample_id       mw_mn   mw_mw   mw_mz mw_dispersity</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Unknown-A    8<span style="text-decoration: underline;">901</span>726. 1.77<span style="color: #949494;">e</span>19 1.06<span style="color: #949494;">e</span>21       1.99<span style="color: #949494;">e</span>12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Unknown-B   17<span style="text-decoration: underline;">884</span>676. 1.65<span style="color: #949494;">e</span>19 9.56<span style="color: #949494;">e</span>20       9.21<span style="color: #949494;">e</span>11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Unknown-C   13<span style="text-decoration: underline;">393</span>541. 1.70<span style="color: #949494;">e</span>19 9.69<span style="color: #949494;">e</span>20       1.27<span style="color: #949494;">e</span>12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Unknown-HMW 16<span style="text-decoration: underline;">212</span>294. 1.20<span style="color: #949494;">e</span>19 9.26<span style="color: #949494;">e</span>20       7.42<span style="color: #949494;">e</span>11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Unknown-LMW 10<span style="text-decoration: underline;">187</span>893. 2.48<span style="color: #949494;">e</span>19 9.98<span style="color: #949494;">e</span>20       2.44<span style="color: #949494;">e</span>12</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="validate-against-true-values">Validate Against True Values<a class="anchor" aria-label="anchor" href="#validate-against-true-values"></a>
</h3>
<p>Compare calculated MW values to the known “true” values:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Join with true values</span></span>
<span><span class="va">validation</span> <span class="op">&lt;-</span> <span class="va">all_results</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="va">sec_raw_unknowns</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="va">true_mw</span>, <span class="va">true_mn</span>, <span class="va">true_dispersity</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"sample_id"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">true_mw</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    mw_error_pct <span class="op">=</span> <span class="op">(</span><span class="va">mw_mw</span> <span class="op">-</span> <span class="va">true_mw</span><span class="op">)</span> <span class="op">/</span> <span class="va">true_mw</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>    mn_error_pct <span class="op">=</span> <span class="op">(</span><span class="va">mw_mn</span> <span class="op">-</span> <span class="va">true_mn</span><span class="op">)</span> <span class="op">/</span> <span class="va">true_mn</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>    disp_error_pct <span class="op">=</span> <span class="op">(</span><span class="va">mw_dispersity</span> <span class="op">-</span> <span class="va">true_dispersity</span><span class="op">)</span> <span class="op">/</span> <span class="va">true_dispersity</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Summary table</span></span>
<span><span class="va">validation</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">sample_id</span>,</span>
<span>    `Calc Mw` <span class="op">=</span> <span class="va">mw_mw</span>,</span>
<span>    `True Mw` <span class="op">=</span> <span class="va">true_mw</span>,</span>
<span>    `Mw Error %` <span class="op">=</span> <span class="va">mw_error_pct</span>,</span>
<span>    `Calc Đ` <span class="op">=</span> <span class="va">mw_dispersity</span>,</span>
<span>    `True Đ` <span class="op">=</span> <span class="va">true_dispersity</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    `Calc Mw` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">`Calc Mw`</span><span class="op">)</span>,</span>
<span>    `Mw Error %` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">`Mw Error %`</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    `Calc Đ` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">`Calc Đ`</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 6</span></span></span>
<span><span class="co">#&gt;   sample_id   `Calc Mw` `True Mw` `Mw Error %` `Calc Đ` `True Đ`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Unknown-A     1.77<span style="color: #949494;">e</span>19     <span style="text-decoration: underline;">45</span>000      3.94<span style="color: #949494;">e</span>16  1.99<span style="color: #949494;">e</span>12     2.05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Unknown-B     1.65<span style="color: #949494;">e</span>19    <span style="text-decoration: underline;">125</span>000      1.32<span style="color: #949494;">e</span>16  9.21<span style="color: #949494;">e</span>11     1.32</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Unknown-C     1.70<span style="color: #949494;">e</span>19     <span style="text-decoration: underline;">82</span>000      2.07<span style="color: #949494;">e</span>16  1.27<span style="color: #949494;">e</span>12     1.09</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Unknown-HMW   1.20<span style="color: #949494;">e</span>19   1<span style="text-decoration: underline;">500</span>000      8.02<span style="color: #949494;">e</span>14  7.42<span style="color: #949494;">e</span>11     1.25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Unknown-LMW   2.48<span style="color: #949494;">e</span>19      <span style="text-decoration: underline;">3</span>500      7.09<span style="color: #949494;">e</span>17  2.44<span style="color: #949494;">e</span>12     1.25</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Parity plot: calculated vs true</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">validation</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">true_mw</span>, <span class="va">mw_mw</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span>, color <span class="op">=</span> <span class="st">"#2E86AB"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">sample_id</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span>scale_cut <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html" class="external-link">cut_short_scale</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span>scale_cut <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html" class="external-link">cut_short_scale</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"True Mw (Da)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Calculated Mw (Da)"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Validation: Calculated vs True Molecular Weight"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Points on the dashed line indicate perfect agreement"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial-conventional-calibration_files/figure-html/validation-plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="handling-special-cases">Handling Special Cases<a class="anchor" aria-label="anchor" href="#handling-special-cases"></a>
</h3>
<div class="section level4">
<h4 id="bimodal-distributions">Bimodal Distributions<a class="anchor" aria-label="anchor" href="#bimodal-distributions"></a>
</h4>
<p>The Unknown-Bimodal sample has two distinct peaks. Standard MW
averages still work, but you may want to analyze each peak
separately:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Process bimodal sample</span></span>
<span><span class="va">bimodal</span> <span class="op">&lt;-</span> <span class="va">sec_raw_unknowns</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sample_id</span> <span class="op">==</span> <span class="st">"Unknown-Bimodal"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rec_bimodal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">ri_mv</span> <span class="op">+</span> <span class="va">time_min</span> <span class="op">~</span> <span class="va">sample_id</span>, data <span class="op">=</span> <span class="va">bimodal</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/roles.html" class="external-link">update_role</a></span><span class="op">(</span><span class="va">sample_id</span>, new_role <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://jameshwade.github.io/measure/reference/step_measure_input_long.html" class="external-link">step_measure_input_long</a></span><span class="op">(</span></span>
<span>    <span class="va">ri_mv</span>,</span>
<span>    location <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">time_min</span><span class="op">)</span>,</span>
<span>    col_name <span class="op">=</span> <span class="st">"ri"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/step_sec_baseline.html">step_sec_baseline</a></span><span class="op">(</span>measures <span class="op">=</span> <span class="st">"ri"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/step_sec_conventional_cal.html">step_sec_conventional_cal</a></span><span class="op">(</span></span>
<span>    standards <span class="op">=</span> <span class="va">ps_cal</span>,</span>
<span>    fit_type <span class="op">=</span> <span class="st">"cubic"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/step_sec_mw_averages.html">step_sec_mw_averages</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_bimodal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span><span class="va">rec_bimodal</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Calibration fit quality is low (R\u00b2 = 0.8324).</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Typical calibrations have R\u00b2 &gt; 0.999.</span></span>
<span><span class="co">#&gt; Warning: Standard at 15.67 has 484.9% MW deviation.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Consider removing outlier standards or using a different fit type.</span></span>
<span><span class="co">#&gt; Warning: 9857 points (91.3%) are outside calibration range.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Calibration range: 14.64 to 16.21</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Bimodal Sample Results:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Bimodal Sample Results:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Mn ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_bimodal</span><span class="op">$</span><span class="va">mw_mn</span><span class="op">)</span>, <span class="st">"Da\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Mn = 21531497 Da</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Mw ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_bimodal</span><span class="op">$</span><span class="va">mw_mw</span><span class="op">)</span>, <span class="st">"Da\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Mw = 1.652672e+19 Da</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Dispersity ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_bimodal</span><span class="op">$</span><span class="va">mw_dispersity</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Dispersity = 7.6756e+11</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nNote: High dispersity indicates the bimodal nature!\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Note: High dispersity indicates the bimodal nature!</span></span>
<span></span>
<span><span class="co"># Plot the bimodal chromatogram with MW scale</span></span>
<span><span class="va">bimodal_chrom</span> <span class="op">&lt;-</span> <span class="va">result_bimodal</span><span class="op">$</span><span class="va">ri</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">bimodal_chrom</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="va">location</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#2E86AB"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50000</span>, <span class="fl">200000</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"#A23B72"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">50000</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">bimodal_chrom</span><span class="op">$</span><span class="va">value</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.8</span>,</span>
<span>           label <span class="op">=</span> <span class="st">"50K"</span>, hjust <span class="op">=</span> <span class="fl">1.2</span>, color <span class="op">=</span> <span class="st">"#A23B72"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">200000</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">bimodal_chrom</span><span class="op">$</span><span class="va">value</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.8</span>,</span>
<span>           label <span class="op">=</span> <span class="st">"200K"</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span>, color <span class="op">=</span> <span class="st">"#A23B72"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span>scale_cut <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html" class="external-link">cut_short_scale</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Molecular Weight (Da)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"RI Signal (processed)"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Bimodal Distribution"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Mixture of 50K and 200K components"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial-conventional-calibration_files/figure-html/bimodal-1.png" class="r-plt" alt="" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="common-issues-and-troubleshooting">Common Issues and Troubleshooting<a class="anchor" aria-label="anchor" href="#common-issues-and-troubleshooting"></a>
</h3>
<table class="table">
<colgroup>
<col width="26%">
<col width="44%">
<col width="29%">
</colgroup>
<thead><tr class="header">
<th>Problem</th>
<th>Possible Cause</th>
<th>Solution</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>MW values all NA</td>
<td>Retention times outside calibration range</td>
<td>Check your integration limits; extend calibration range</td>
</tr>
<tr class="even">
<td>Very high error for HMW samples</td>
<td>Extrapolation beyond highest standard</td>
<td>Use higher MW standards or MALS for very high MW</td>
</tr>
<tr class="odd">
<td>Dispersity &gt; 3</td>
<td>Multiple peaks or aggregates</td>
<td>Check chromatogram; may need peak deconvolution</td>
</tr>
<tr class="even">
<td>Negative MW values</td>
<td>Severe baseline issues</td>
<td>Improve baseline correction; check for air bubbles</td>
</tr>
<tr class="odd">
<td>Inconsistent results day-to-day</td>
<td>Calibration drift</td>
<td>Rebuild calibration; check column condition</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h3>
<p>You’ve completed a realistic SEC analysis workflow:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Processed raw standards</strong> with baseline
correction</li>
<li>
<strong>Built a calibration curve</strong> with quality validation
(R² &gt; 0.999)</li>
<li>
<strong>Saved the calibration</strong> for future use</li>
<li>
<strong>Analyzed unknown samples</strong> and calculated MW
averages</li>
<li>
<strong>Validated results</strong> against known true values</li>
</ol>
<div class="section level4">
<h4 id="key-takeaways">Key Takeaways<a class="anchor" aria-label="anchor" href="#key-takeaways"></a>
</h4>
<ul>
<li>
<strong>Start with good standards</strong>: Use narrow dispersity
standards that bracket your sample MW range</li>
<li>
<strong>Validate your calibration</strong>: Check R², residuals, and
% deviation before using</li>
<li>
<strong>Watch for extrapolation</strong>: MW values outside your
calibration range are unreliable</li>
<li>
<strong>Save calibrations with metadata</strong>: Include date,
column, conditions for traceability</li>
<li>
<strong>Re-calibrate periodically</strong>: Columns degrade; rebuild
calibration monthly or when QC fails</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h3>
<table class="table">
<colgroup>
<col width="37%">
<col width="62%">
</colgroup>
<thead><tr class="header">
<th>Task</th>
<th>Resource</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Multi-detector analysis</td>
<td><a href="triple-detection.html">Triple Detection Tutorial</a></td>
</tr>
<tr class="even">
<td>Absolute MW without standards</td>
<td><a href="mals-detection.html">MALS Detection Guide</a></td>
</tr>
<tr class="odd">
<td>Save/load calibrations</td>
<td><a href="calibration-management.html">Calibration
Management</a></td>
</tr>
<tr class="even">
<td>Set up QC checks</td>
<td><a href="system-suitability.html">System Suitability</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] ggplot2_4.0.1          tidyr_1.3.2            measure.sec_0.0.0.9000</span></span>
<span><span class="co">#&gt; [4] measure_0.0.1.9001     recipes_1.3.1          dplyr_1.1.4           </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] gtable_0.3.6        xfun_0.55           bslib_0.9.0        </span></span>
<span><span class="co">#&gt;  [4] lattice_0.22-7      vctrs_0.6.5         tools_4.5.2        </span></span>
<span><span class="co">#&gt;  [7] generics_0.1.4      parallel_4.5.2      tibble_3.3.0       </span></span>
<span><span class="co">#&gt; [10] pkgconfig_2.0.3     Matrix_1.7-4        data.table_1.18.0  </span></span>
<span><span class="co">#&gt; [13] RColorBrewer_1.1-3  S7_0.2.1            desc_1.4.3         </span></span>
<span><span class="co">#&gt; [16] lifecycle_1.0.4     compiler_4.5.2      farver_2.1.2       </span></span>
<span><span class="co">#&gt; [19] textshaping_1.0.4   codetools_0.2-20    htmltools_0.5.9    </span></span>
<span><span class="co">#&gt; [22] class_7.3-23        sass_0.4.10         yaml_2.3.12        </span></span>
<span><span class="co">#&gt; [25] prodlim_2025.04.28  pillar_1.11.1       pkgdown_2.2.0      </span></span>
<span><span class="co">#&gt; [28] jquerylib_0.1.4     MASS_7.3-65         cachem_1.1.0       </span></span>
<span><span class="co">#&gt; [31] gower_1.0.2         rpart_4.1.24        nlme_3.1-168       </span></span>
<span><span class="co">#&gt; [34] parallelly_1.46.0   lava_1.8.2          tidyselect_1.2.1   </span></span>
<span><span class="co">#&gt; [37] digest_0.6.39       future_1.68.0       purrr_1.2.0        </span></span>
<span><span class="co">#&gt; [40] listenv_0.10.0      labeling_0.4.3      splines_4.5.2      </span></span>
<span><span class="co">#&gt; [43] fastmap_1.2.0       grid_4.5.2          cli_3.6.5          </span></span>
<span><span class="co">#&gt; [46] magrittr_2.0.4      utf8_1.2.6          survival_3.8-3     </span></span>
<span><span class="co">#&gt; [49] future.apply_1.20.1 withr_3.0.2         scales_1.4.0       </span></span>
<span><span class="co">#&gt; [52] lubridate_1.9.4     timechange_0.3.0    rmarkdown_2.30     </span></span>
<span><span class="co">#&gt; [55] globals_0.18.0      nnet_7.3-20         timeDate_4051.111  </span></span>
<span><span class="co">#&gt; [58] ragg_1.5.0          evaluate_1.0.5      knitr_1.51         </span></span>
<span><span class="co">#&gt; [61] hardhat_1.4.2       viridisLite_0.4.2   mgcv_1.9-3         </span></span>
<span><span class="co">#&gt; [64] rlang_1.1.6         Rcpp_1.1.0          glue_1.8.0         </span></span>
<span><span class="co">#&gt; [67] ipred_0.9-15        jsonlite_2.0.0      R6_2.6.1           </span></span>
<span><span class="co">#&gt; [70] systemfonts_1.3.1   fs_1.6.6</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/JamesHWade" class="external-link">James Wade</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
