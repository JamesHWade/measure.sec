% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/step_sec_broad_standard.R
\name{step_sec_broad_standard}
\alias{step_sec_broad_standard}
\title{Broad Standard Calibration for SEC/GPC}
\usage{
step_sec_broad_standard(
  recipe,
  measures = NULL,
  broad_standard = NULL,
  known_mn = NULL,
  known_mw = NULL,
  fit_type = c("linear", "quadratic"),
  method = c("hamielec", "integral"),
  reference_mwd = NULL,
  integration_range = NULL,
  extrapolation = c("warn", "none"),
  output_col = "mw",
  log_output = TRUE,
  role = NA,
  trained = FALSE,
  skip = FALSE,
  id = recipes::rand_id("sec_broad_standard")
)
}
\arguments{
\item{recipe}{A recipe object.}

\item{measures}{Character vector of measure columns to apply calibration to.
If \code{NULL}, uses all measure columns.}

\item{broad_standard}{A data frame containing the broad standard chromatogram:
\itemize{
\item \code{location} (or \code{time}, \code{volume}, \code{retention}, \code{elution_time},
\code{elution_volume}): Elution position
\item \code{value} (or \code{signal}, \code{response}, \code{intensity}, \code{ri}, \code{uv}): Detector response
}}

\item{known_mn}{Known number-average molecular weight (Mn) in Daltons.}

\item{known_mw}{Known weight-average molecular weight (Mw) in Daltons.}

\item{fit_type}{Type of calibration curve:
\itemize{
\item \code{"linear"} (default): log10(M) = C1 + C2*V (classic Hamielec)
\item \code{"quadratic"}: log10(M) = C1 + C2\emph{V + C3}V^2
}}

\item{method}{Calibration method:
\itemize{
\item \code{"hamielec"} (default): Optimize to match Mn and Mw
\item \code{"integral"}: Use cumulative MWD matching (requires \code{reference_mwd})
}}

\item{reference_mwd}{Optional data frame for integral method containing the
known cumulative molecular weight distribution of the broad standard:
\itemize{
\item \code{mw}: Molecular weight values (Daltons)
\item \code{cumulative}: Cumulative weight fraction (0 to 1)
}

Required when \code{method = "integral"}. Can be obtained from the standard's
certificate of analysis or determined by light scattering/viscometry.}

\item{integration_range}{Optional numeric vector \code{c(min, max)} specifying
the elution range to use for the broad standard. If \code{NULL}, auto-detects
peak region.}

\item{extrapolation}{How to handle data outside the calibration range:
\itemize{
\item \code{"warn"} (default): Extrapolate but warn
\item \code{"none"}: Return NA for out-of-range values
}}

\item{output_col}{Name for the output molecular weight column.
Default is \code{"mw"}.}

\item{log_output}{Logical. If \code{TRUE} (default), output column contains
log10(MW). If \code{FALSE}, output contains MW in Daltons.}

\item{role}{Role for generated columns.}

\item{trained}{Logical indicating if the step has been trained.}

\item{skip}{Logical. Should the step be skipped when baking?}

\item{id}{Unique step identifier.}
}
\value{
An updated recipe with the new step added.
}
\description{
\code{step_sec_broad_standard()} creates a \emph{specification} of a recipe step that
fits a calibration curve using a polydisperse (broad) molecular weight
standard with known Mn and Mw values.
}
\details{
This step implements broad standard calibration methods for SEC/GPC, which
use a single polydisperse standard with known molecular weight averages
instead of multiple narrow standards.

\strong{Hamielec Method:}

Based on Balke, Hamielec, LeClair, and Pearce (1969). The original method
assumes a linear calibration relationship, though this implementation also
supports a quadratic extension for better fit over wide MW ranges:

\deqn{\log_{10}(M) = C_1 + C_2 \cdot V}

The algorithm simultaneously optimizes coefficients C1 and C2 (and C3 for
quadratic fits) using Nelder-Mead optimization to minimize the squared
relative errors between calculated and known Mn and Mw values.

\strong{Integral/Cumulative Match Method:}

The integral method matches the entire cumulative MWD shape rather than just
Mn and Mw. This requires a reference cumulative distribution (\code{reference_mwd})
typically obtained from the standard's certificate or measured by light
scattering/viscometry. The algorithm optimizes calibration coefficients to
minimize the sum of squared differences between the calculated and reference
cumulative distributions.

This method is more robust than Hamielec because it uses the full distribution
shape, not just two moments. It's particularly useful when the standard's
MWD shape is well-characterized.

\strong{When to Use Broad Standard Calibration:}
\itemize{
\item QC labs running the same polymer type repeatedly
\item When narrow standards aren't available for your polymer
\item When you have a well-characterized in-house reference material
\item Provides "absolute" molecular weights for the same polymer type
}

\strong{Limitations:}
\itemize{
\item Results are only valid for polymers with similar hydrodynamic behavior
\item Linear calibration may not fit well over very wide MW ranges
\item Requires well-characterized broad standard (accurate Mn and Mw)
\item Integral method requires full cumulative MWD data
}
}
\examples{
\dontrun{
library(recipes)
library(measure)

data(sec_triple_detect)

# Create broad standard chromatogram data
broad_std <- data.frame(
  time = seq(10, 20, by = 0.1),
  signal = dnorm(seq(10, 20, by = 0.1), mean = 15, sd = 1.5)
)

# Apply broad standard calibration
rec <- recipe(~., data = sec_triple_detect) |>
  step_measure_input_long(
    ri_signal,
    location = vars(elution_time),
    col_name = "ri"
  ) |>
  step_sec_baseline() |>
  step_sec_broad_standard(
    broad_standard = broad_std,
    known_mn = 50000,
    known_mw = 150000
  ) |>
  prep()

# Check calibration results
tidy(rec, number = 3)
}
}
\references{
Balke, S.T., Hamielec, A.E., LeClair, B.P., and Pearce, S.L. (1969).
Gel permeation chromatography.
\emph{Industrial & Engineering Chemistry Product Research and Development},
8(1), 54-57.
}
\seealso{
Other sec-calibration: 
\code{\link{load_sec_calibration}()},
\code{\link{save_sec_calibration}()},
\code{\link{sec_calibration_standards}},
\code{\link{sec_pmma_standards}},
\code{\link{sec_ps_standards}},
\code{\link{step_sec_conventional_cal}()},
\code{\link{step_sec_universal_cal}()}
}
\concept{sec-calibration}
