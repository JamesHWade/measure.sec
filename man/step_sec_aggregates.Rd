% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/step_sec_aggregates.R
\name{step_sec_aggregates}
\alias{step_sec_aggregates}
\title{Quantify Protein Aggregates and Fragments in SEC}
\usage{
step_sec_aggregates(
  recipe,
  measures = NULL,
  monomer_start = NULL,
  monomer_end = NULL,
  method = c("tallest", "manual"),
  hmws_threshold = 0.001,
  include_main_peak = TRUE,
  output_prefix = "purity_",
  role = NA,
  trained = FALSE,
  skip = FALSE,
  id = recipes::rand_id("sec_aggregates")
)
}
\arguments{
\item{recipe}{A recipe object.}

\item{measures}{Character vector of measure columns to analyze. If \code{NULL},
analyzes all measure columns.}

\item{monomer_start}{Start of the monomer peak region (in location units,
typically minutes). If \code{NULL}, automatically determined.}

\item{monomer_end}{End of the monomer peak region. If \code{NULL}, automatically
determined.}

\item{method}{Method for peak boundary detection when \code{monomer_start} or
\code{monomer_end} is \code{NULL}:
\itemize{
\item \code{"tallest"} (default): Uses the tallest peak as monomer
\item \code{"manual"}: Requires explicit boundaries
}}

\item{hmws_threshold}{Minimum fraction of monomer height to consider as
HMWS signal. Default is 0.001 (0.1\%). Below this, signal is considered
baseline.}

\item{include_main_peak}{Logical. Include the main peak boundaries in output?
Default is TRUE.}

\item{output_prefix}{Prefix for output columns. Default is \code{"purity_"}.
Creates columns: \verb{\{prefix\}hmws}, \verb{\{prefix\}monomer}, \verb{\{prefix\}lmws}.}

\item{role}{Role for generated columns.}

\item{trained}{Logical indicating if the step has been trained.}

\item{skip}{Logical. Should the step be skipped when baking?}

\item{id}{Unique step identifier.}
}
\value{
An updated recipe with new columns containing aggregate percentages:
\describe{
\item{purity_hmws}{Percent high molecular weight species (aggregates)}
\item{purity_monomer}{Percent monomer (main peak)}
\item{purity_lmws}{Percent low molecular weight species (fragments)}
\item{purity_main_start}{Start of main peak region (if include_main_peak)}
\item{purity_main_end}{End of main peak region (if include_main_peak)}
}
}
\description{
\code{step_sec_aggregates()} creates a \emph{specification} of a recipe step that
quantifies high molecular weight species (HMWS/aggregates), monomers, and
low molecular weight species (LMWS/fragments) from protein SEC chromatograms.
}
\details{
Aggregate analysis is critical for biopharmaceutical characterization:

\itemize{
\item HMWS (High Molecular Weight Species): Elute before the monomer peak.
Includes dimers, trimers, and higher-order aggregates.
\item Monomer: The main therapeutic protein peak.
\item LMWS (Low Molecular Weight Species): Elute after the monomer peak.
Includes fragments, clips, and degradation products.
}

\strong{Calculation Method:}
\deqn{\% HMWS = \frac{A_{HMWS}}{A_{total}} \times 100}
\deqn{\% Monomer = \frac{A_{monomer}}{A_{total}} \times 100}
\deqn{\% LMWS = \frac{A_{LMWS}}{A_{total}} \times 100}

where A represents integrated peak areas.

\strong{Regulatory Importance:}
\itemize{
\item ICH Q6B requires aggregate content specification
\item USP <129> provides guidance on aggregate testing
\item Typical acceptance: HMWS < 5\%, Monomer > 95\%
}
}
\note{
For accurate results:
\itemize{
\item Baseline correct the chromatogram first
\item Ensure proper column resolution (especially for dimer separation)
\item Use UV detection at 280 nm (or 214 nm for higher sensitivity)
}
}
\examples{
\dontrun{
library(recipes)
library(measure)

# Analyze mAb aggregate content
rec <- recipe(~., data = mab_data) |>
  step_measure_input_long(uv280, location = vars(elution_time), col_name = "uv") |>
  step_sec_baseline() |>
  step_sec_aggregates(
    monomer_start = 8.5,
    monomer_end = 10.5
  ) |>
  prep()

# Automatic peak detection
rec <- recipe(~., data = mab_data) |>
  step_measure_input_long(uv280, location = vars(elution_time), col_name = "uv") |>
  step_sec_baseline() |>
  step_sec_aggregates(method = "tallest") |>
  prep()
}
}
\concept{sec-protein}
