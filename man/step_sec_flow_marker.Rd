% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/step_sec_flow_marker.R
\name{step_sec_flow_marker}
\alias{step_sec_flow_marker}
\title{Flow Marker Correction for SEC/GPC}
\usage{
step_sec_flow_marker(
  recipe,
  measures = NULL,
  marker_range = NULL,
  target_volume = NULL,
  auto_detect = TRUE,
  min_peak_height = NULL,
  store_correction = TRUE,
  role = NA,
  trained = FALSE,
  skip = FALSE,
  id = recipes::rand_id("sec_flow_marker")
)
}
\arguments{
\item{recipe}{A recipe object.}

\item{measures}{Character vector of measure column names to correct.
If \code{NULL}, uses all measure columns.}

\item{marker_range}{Numeric vector of length 2 specifying the expected
elution range \code{c(min, max)} where the flow marker peak is expected.
Required unless \code{auto_detect = TRUE} with \code{expected_volume} specified.}

\item{target_volume}{The target elution volume to align the flow marker to.
If \code{NULL} (default), uses the first value of \code{marker_range}.}

\item{auto_detect}{Logical. If \code{TRUE}, automatically detect the flow marker
peak within \code{marker_range}. If \code{FALSE}, uses the peak maximum within range.
Default is \code{TRUE}.}

\item{min_peak_height}{Minimum peak height (in signal units) for a valid
flow marker detection. Peaks below this threshold are ignored.
Default is \code{NULL} (no minimum).}

\item{store_correction}{Logical. If \code{TRUE}, stores the correction factor
as a column named \code{flow_marker_correction}. Default is \code{TRUE}.}

\item{role}{Role for generated columns.}

\item{trained}{Logical indicating if the step has been trained.}

\item{skip}{Logical. Should the step be skipped when baking?}

\item{id}{Unique step identifier.}
}
\value{
An updated recipe with the new step added.
}
\description{
\code{step_sec_flow_marker()} creates a \emph{specification} of a recipe step that
detects a flow marker peak (typically toluene or other small molecule) and
applies a linear correction to align retention times/volumes across runs.
}
\details{
Flow marker correction compensates for small variations in flow rate between
runs. A flow marker is a small molecule (often toluene) that elutes near the
total permeation volume and provides a reference point for alignment.

\strong{Correction Algorithm:}
\enumerate{
\item Find the flow marker peak maximum within \code{marker_range}
\item Calculate the shift: \code{correction = observed_volume - target_volume}
\item Apply linear correction: \code{corrected_volume = original_volume - correction}
}

\strong{Auto-Detection:}

When \code{auto_detect = TRUE}, the step uses second-derivative analysis to find
the sharpest peak in the specified range, which is typically the flow marker.
This is more robust than simply finding the maximum signal.

\strong{Prerequisites:}
\itemize{
\item Should be applied before calibration and MW calculations
\item Best applied after baseline correction
}
}
\examples{
\dontrun{
library(recipes)
library(measure)

# Apply flow marker correction with known range
rec <- recipe(~., data = sec_data) |>
  step_measure_input_long(ri, location = vars(elution_volume)) |>
  step_sec_baseline() |>
  step_sec_flow_marker(
    marker_range = c(18, 20),
    target_volume = 18.5
  ) |>
  step_sec_conventional_cal(standards = ps_standards) |>
  prep()

# Auto-detect flow marker with default target (first value of range)
rec <- recipe(~., data = sec_data) |>
  step_measure_input_long(ri, location = vars(elution_volume)) |>
  step_sec_flow_marker(marker_range = c(18, 20)) |>
  prep()
}
}
\concept{sec-preprocessing}
