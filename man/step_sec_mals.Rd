% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/step_sec_mals.R
\name{step_sec_mals}
\alias{step_sec_mals}
\title{Multi-Angle Light Scattering Processing for SEC}
\usage{
step_sec_mals(
  recipe,
  mals_col = NULL,
  concentration_col = NULL,
  dn_dc = NULL,
  dn_dc_column = NULL,
  wavelength = 658,
  solvent_ri = 1.333,
  angles = 90,
  formalism = c("zimm", "debye", "berry"),
  calibration_constant = NULL,
  output_mw = "mw_mals",
  output_rg = "rg",
  min_signal = 0.01,
  role = NA,
  trained = FALSE,
  skip = FALSE,
  id = recipes::rand_id("sec_mals")
)
}
\arguments{
\item{recipe}{A recipe object.}

\item{mals_col}{Name of the MALS detector measure column. For single-angle
detectors (RALS/LALS), this is the only signal needed.}

\item{concentration_col}{Name of the concentration measure column (from
\code{step_sec_concentration()} or similar).}

\item{dn_dc}{Refractive index increment (mL/g). Required for absolute MW.}

\item{dn_dc_column}{Column containing sample-specific dn/dc values.}

\item{wavelength}{Laser wavelength in nm. Default is 658 (common for MALS).}

\item{solvent_ri}{Solvent refractive index. Default is 1.333 (water).
Common values: water = 1.333, THF = 1.407, toluene = 1.497.}

\item{angles}{Numeric vector of detection angles in degrees. For single-angle
detectors, provide just one value (e.g., \code{90} for RALS). Default assumes
a 90-degree detector.}

\item{formalism}{Angular extrapolation method for multi-angle data:
\code{"zimm"} (default), \code{"debye"}, or \code{"berry"}.}

\item{calibration_constant}{MALS instrument calibration constant. If \code{NULL},
results are in relative units. Obtain from toluene standard calibration.}

\item{output_mw}{Name for the molecular weight output column. Default is \code{"mw_mals"}.}

\item{output_rg}{Name for the radius of gyration output column. Default is \code{"rg"}.
Only calculated if multiple angles are provided.}

\item{min_signal}{Minimum signal threshold (as fraction of max) below which
MW is set to NA. Default is 0.01.}

\item{role}{Role for generated columns.}

\item{trained}{Logical indicating if the step has been trained.}

\item{skip}{Logical. Should the step be skipped when baking?}

\item{id}{Unique step identifier.}
}
\value{
An updated recipe with the new step added, containing absolute MW
(and optionally Rg) at each elution point.
}
\description{
\code{step_sec_mals()} creates a \emph{specification} of a recipe step that processes
multi-angle light scattering (MALS) detector signals to determine absolute
molecular weight and radius of gyration at each elution slice.
}
\details{
Light scattering provides absolute molecular weight without calibration
standards. The fundamental relationship is:

\deqn{\frac{K \cdot c}{R(\theta)} = \frac{1}{M_w} \cdot P(\theta) + 2A_2 c}

where:
\itemize{
\item K is the optical constant
\item c is the concentration
\item R(theta) is the excess Rayleigh ratio
\item Mw is the weight-average molecular weight
\item P(theta) is the particle scattering function
\item A2 is the second virial coefficient
}

The optical constant K is calculated as:
\deqn{K = \frac{4\pi^2 n_0^2 (dn/dc)^2}{N_A \lambda^4}}

\strong{Formalisms for Angular Extrapolation:}
\itemize{
\item Zimm: Kc/R vs sin^2(theta/2) - best for random coils
\item Debye: Kc/R vs sin^2(theta/2) - similar to Zimm
\item Berry: sqrt(Kc/R) vs sin^2(theta/2) - better for large particles
}

\strong{Single-Angle vs Multi-Angle:}
\itemize{
\item Single angle (RALS/LALS): Provides Mw only, assumes P(theta) ~ 1
\item Multi-angle (MALS): Provides both Mw and Rg from angular dependence
}
}
\note{
Accurate results require:
\itemize{
\item Known and accurate dn/dc value
\item Calibrated instrument (calibration_constant from toluene)
\item Accurate concentration from RI detector
\item Clean baseline and aligned detectors
}
}
\examples{
\dontrun{
library(recipes)
library(measure)

# Single-angle (90 degree) light scattering
rec <- recipe(~., data = sec_triple_detect) |>
  step_measure_input_long(ri_signal, location = vars(elution_time), col_name = "ri") |>
  step_measure_input_long(mals_signal, location = vars(elution_time), col_name = "mals") |>
  step_sec_baseline() |>
  step_sec_ri(dn_dc = 0.185) |>
  step_sec_concentration(detector = "ri", injection_mass = 0.2, flow_rate = 1.0) |>
  step_sec_mals(
    mals_col = "mals",
    concentration_col = "ri",
    dn_dc = 0.185,
    wavelength = 658,
    angles = 90
  ) |>
  prep()
}
}
\seealso{
Other sec-detectors: 
\code{\link{step_sec_intrinsic_visc}()},
\code{\link{step_sec_viscometer}()}
}
\concept{sec-detectors}
